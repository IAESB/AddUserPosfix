#include "clienttemplaterepository.h"
#include "util.hpp"
ClientTemplateRepository::ClientTemplateRepository(soci::session& db) : dataBase(db)
{
}

ClientTemplatePtr ClientTemplateRepository::select(const ClientTemplate& obj)
{
	soci::row row;
	ClientTemplatePtr clienttemplate(new ClientTemplate);
	dataBase << "SELECT  client_template.template_id as ClientTemplate_template_id, client_template.sys_userid as ClientTemplate_sys_userid, client_template.sys_groupid as ClientTemplate_sys_groupid, client_template.sys_perm_user as ClientTemplate_sys_perm_user, client_template.sys_perm_group as ClientTemplate_sys_perm_group, client_template.sys_perm_other as ClientTemplate_sys_perm_other, client_template.template_name as ClientTemplate_template_name, client_template.template_type as ClientTemplate_template_type, client_template.limit_maildomain as ClientTemplate_limit_maildomain, client_template.limit_mailbox as ClientTemplate_limit_mailbox, client_template.limit_mailalias as ClientTemplate_limit_mailalias, client_template.limit_mailaliasdomain as ClientTemplate_limit_mailaliasdomain, client_template.limit_mailforward as ClientTemplate_limit_mailforward, client_template.limit_mailcatchall as ClientTemplate_limit_mailcatchall, client_template.limit_mailrouting as ClientTemplate_limit_mailrouting, client_template.limit_mailfilter as ClientTemplate_limit_mailfilter, client_template.limit_fetchmail as ClientTemplate_limit_fetchmail, client_template.limit_mailquota as ClientTemplate_limit_mailquota, client_template.limit_spamfilter_wblist as ClientTemplate_limit_spamfilter_wblist, client_template.limit_spamfilter_user as ClientTemplate_limit_spamfilter_user, client_template.limit_spamfilter_policy as ClientTemplate_limit_spamfilter_policy, client_template.limit_web_ip as ClientTemplate_limit_web_ip, client_template.limit_web_domain as ClientTemplate_limit_web_domain, client_template.limit_web_quota as ClientTemplate_limit_web_quota, client_template.web_php_options as ClientTemplate_web_php_options, client_template.limit_cgi as ClientTemplate_limit_cgi, client_template.limit_ssi as ClientTemplate_limit_ssi, client_template.limit_perl as ClientTemplate_limit_perl, client_template.limit_ruby as ClientTemplate_limit_ruby, client_template.limit_python as ClientTemplate_limit_python, client_template.force_suexec as ClientTemplate_force_suexec, client_template.limit_hterror as ClientTemplate_limit_hterror, client_template.limit_wildcard as ClientTemplate_limit_wildcard, client_template.limit_ssl as ClientTemplate_limit_ssl, client_template.limit_web_subdomain as ClientTemplate_limit_web_subdomain, client_template.limit_web_aliasdomain as ClientTemplate_limit_web_aliasdomain, client_template.limit_ftp_user as ClientTemplate_limit_ftp_user, client_template.limit_shell_user as ClientTemplate_limit_shell_user, client_template.ssh_chroot as ClientTemplate_ssh_chroot, client_template.limit_webdav_user as ClientTemplate_limit_webdav_user, client_template.limit_backup as ClientTemplate_limit_backup, client_template.limit_aps as ClientTemplate_limit_aps, client_template.limit_dns_zone as ClientTemplate_limit_dns_zone, client_template.limit_dns_slave_zone as ClientTemplate_limit_dns_slave_zone, client_template.limit_dns_record as ClientTemplate_limit_dns_record, client_template.limit_database as ClientTemplate_limit_database, client_template.limit_database_quota as ClientTemplate_limit_database_quota, client_template.limit_cron as ClientTemplate_limit_cron, client_template.limit_cron_type as ClientTemplate_limit_cron_type, client_template.limit_cron_frequency as ClientTemplate_limit_cron_frequency, client_template.limit_traffic_quota as ClientTemplate_limit_traffic_quota, client_template.limit_client as ClientTemplate_limit_client, client_template.limit_domainmodule as ClientTemplate_limit_domainmodule, client_template.limit_mailmailinglist as ClientTemplate_limit_mailmailinglist, client_template.limit_openvz_vm as ClientTemplate_limit_openvz_vm, client_template.limit_openvz_vm_template_id as ClientTemplate_limit_openvz_vm_template_id"
	" FROM client_template "
	"WHERE client_template.template_id = :ClientTemplate_template_id", into(row), use(obj);
	if(!dataBase.got_data())
		clienttemplate.reset();
	else
		type_conversion<ClientTemplate>::from_base(row, i_ok, *clienttemplate);
	return clienttemplate;
}
ClientTemplateList ClientTemplateRepository::select(const string& where)
{
	soci::rowset<row> rs = 	dataBase.prepare << "SELECT  client_template.template_id as ClientTemplate_template_id, client_template.sys_userid as ClientTemplate_sys_userid, client_template.sys_groupid as ClientTemplate_sys_groupid, client_template.sys_perm_user as ClientTemplate_sys_perm_user, client_template.sys_perm_group as ClientTemplate_sys_perm_group, client_template.sys_perm_other as ClientTemplate_sys_perm_other, client_template.template_name as ClientTemplate_template_name, client_template.template_type as ClientTemplate_template_type, client_template.limit_maildomain as ClientTemplate_limit_maildomain, client_template.limit_mailbox as ClientTemplate_limit_mailbox, client_template.limit_mailalias as ClientTemplate_limit_mailalias, client_template.limit_mailaliasdomain as ClientTemplate_limit_mailaliasdomain, client_template.limit_mailforward as ClientTemplate_limit_mailforward, client_template.limit_mailcatchall as ClientTemplate_limit_mailcatchall, client_template.limit_mailrouting as ClientTemplate_limit_mailrouting, client_template.limit_mailfilter as ClientTemplate_limit_mailfilter, client_template.limit_fetchmail as ClientTemplate_limit_fetchmail, client_template.limit_mailquota as ClientTemplate_limit_mailquota, client_template.limit_spamfilter_wblist as ClientTemplate_limit_spamfilter_wblist, client_template.limit_spamfilter_user as ClientTemplate_limit_spamfilter_user, client_template.limit_spamfilter_policy as ClientTemplate_limit_spamfilter_policy, client_template.limit_web_ip as ClientTemplate_limit_web_ip, client_template.limit_web_domain as ClientTemplate_limit_web_domain, client_template.limit_web_quota as ClientTemplate_limit_web_quota, client_template.web_php_options as ClientTemplate_web_php_options, client_template.limit_cgi as ClientTemplate_limit_cgi, client_template.limit_ssi as ClientTemplate_limit_ssi, client_template.limit_perl as ClientTemplate_limit_perl, client_template.limit_ruby as ClientTemplate_limit_ruby, client_template.limit_python as ClientTemplate_limit_python, client_template.force_suexec as ClientTemplate_force_suexec, client_template.limit_hterror as ClientTemplate_limit_hterror, client_template.limit_wildcard as ClientTemplate_limit_wildcard, client_template.limit_ssl as ClientTemplate_limit_ssl, client_template.limit_web_subdomain as ClientTemplate_limit_web_subdomain, client_template.limit_web_aliasdomain as ClientTemplate_limit_web_aliasdomain, client_template.limit_ftp_user as ClientTemplate_limit_ftp_user, client_template.limit_shell_user as ClientTemplate_limit_shell_user, client_template.ssh_chroot as ClientTemplate_ssh_chroot, client_template.limit_webdav_user as ClientTemplate_limit_webdav_user, client_template.limit_backup as ClientTemplate_limit_backup, client_template.limit_aps as ClientTemplate_limit_aps, client_template.limit_dns_zone as ClientTemplate_limit_dns_zone, client_template.limit_dns_slave_zone as ClientTemplate_limit_dns_slave_zone, client_template.limit_dns_record as ClientTemplate_limit_dns_record, client_template.limit_database as ClientTemplate_limit_database, client_template.limit_database_quota as ClientTemplate_limit_database_quota, client_template.limit_cron as ClientTemplate_limit_cron, client_template.limit_cron_type as ClientTemplate_limit_cron_type, client_template.limit_cron_frequency as ClientTemplate_limit_cron_frequency, client_template.limit_traffic_quota as ClientTemplate_limit_traffic_quota, client_template.limit_client as ClientTemplate_limit_client, client_template.limit_domainmodule as ClientTemplate_limit_domainmodule, client_template.limit_mailmailinglist as ClientTemplate_limit_mailmailinglist, client_template.limit_openvz_vm as ClientTemplate_limit_openvz_vm, client_template.limit_openvz_vm_template_id as ClientTemplate_limit_openvz_vm_template_id "
	" FROM client_template" 
	<< (where.size()?" WHERE "+where:"");
	ClientTemplateList clienttemplateList;
	for(row& r: rs)
	{
		ClientTemplatePtr clienttemplate(new ClientTemplate);
		type_conversion<ClientTemplate>::from_base(r, i_ok, *clienttemplate);
		clienttemplateList.push_back(clienttemplate);
	}
	return clienttemplateList;
}

int ClientTemplateRepository::insert(const ClientTemplate& clienttemplate)
{
	dataBase << "insert into client_template(template_id, sys_userid, sys_groupid, sys_perm_user, sys_perm_group, sys_perm_other, template_name, template_type, limit_maildomain, limit_mailbox, limit_mailalias, limit_mailaliasdomain, limit_mailforward, limit_mailcatchall, limit_mailrouting, limit_mailfilter, limit_fetchmail, limit_mailquota, limit_spamfilter_wblist, limit_spamfilter_user, limit_spamfilter_policy, limit_web_ip, limit_web_domain, limit_web_quota, web_php_options, limit_cgi, limit_ssi, limit_perl, limit_ruby, limit_python, force_suexec, limit_hterror, limit_wildcard, limit_ssl, limit_web_subdomain, limit_web_aliasdomain, limit_ftp_user, limit_shell_user, ssh_chroot, limit_webdav_user, limit_backup, limit_aps, limit_dns_zone, limit_dns_slave_zone, limit_dns_record, limit_database, limit_database_quota, limit_cron, limit_cron_type, limit_cron_frequency, limit_traffic_quota, limit_client, limit_domainmodule, limit_mailmailinglist, limit_openvz_vm, limit_openvz_vm_template_id)\
values(:ClientTemplate_template_id, :ClientTemplate_sys_userid, :ClientTemplate_sys_groupid, :ClientTemplate_sys_perm_user, :ClientTemplate_sys_perm_group, :ClientTemplate_sys_perm_other, :ClientTemplate_template_name, :ClientTemplate_template_type, :ClientTemplate_limit_maildomain, :ClientTemplate_limit_mailbox, :ClientTemplate_limit_mailalias, :ClientTemplate_limit_mailaliasdomain, :ClientTemplate_limit_mailforward, :ClientTemplate_limit_mailcatchall, :ClientTemplate_limit_mailrouting, :ClientTemplate_limit_mailfilter, :ClientTemplate_limit_fetchmail, :ClientTemplate_limit_mailquota, :ClientTemplate_limit_spamfilter_wblist, :ClientTemplate_limit_spamfilter_user, :ClientTemplate_limit_spamfilter_policy, :ClientTemplate_limit_web_ip, :ClientTemplate_limit_web_domain, :ClientTemplate_limit_web_quota, :ClientTemplate_web_php_options, :ClientTemplate_limit_cgi, :ClientTemplate_limit_ssi, :ClientTemplate_limit_perl, :ClientTemplate_limit_ruby, :ClientTemplate_limit_python, :ClientTemplate_force_suexec, :ClientTemplate_limit_hterror, :ClientTemplate_limit_wildcard, :ClientTemplate_limit_ssl, :ClientTemplate_limit_web_subdomain, :ClientTemplate_limit_web_aliasdomain, :ClientTemplate_limit_ftp_user, :ClientTemplate_limit_shell_user, :ClientTemplate_ssh_chroot, :ClientTemplate_limit_webdav_user, :ClientTemplate_limit_backup, :ClientTemplate_limit_aps, :ClientTemplate_limit_dns_zone, :ClientTemplate_limit_dns_slave_zone, :ClientTemplate_limit_dns_record, :ClientTemplate_limit_database, :ClientTemplate_limit_database_quota, :ClientTemplate_limit_cron, :ClientTemplate_limit_cron_type, :ClientTemplate_limit_cron_frequency, :ClientTemplate_limit_traffic_quota, :ClientTemplate_limit_client, :ClientTemplate_limit_domainmodule, :ClientTemplate_limit_mailmailinglist, :ClientTemplate_limit_openvz_vm, :ClientTemplate_limit_openvz_vm_template_id)", use(clienttemplate);
	int id=0;
	dataBase << "SELECT LAST_INSERT_ID()", soci::into(id);
	return id;
}

void ClientTemplateRepository::remove(const ClientTemplate& clienttemplate)
{
	dataBase << "DELETE from client_template WHERE template_id=:ClientTemplate_template_id", use(clienttemplate);
}

void ClientTemplateRepository::update(const ClientTemplate& clienttemplate)
{
	dataBase << "update client_template set template_id=:ClientTemplate_template_id, sys_userid=:ClientTemplate_sys_userid, sys_groupid=:ClientTemplate_sys_groupid, sys_perm_user=:ClientTemplate_sys_perm_user, sys_perm_group=:ClientTemplate_sys_perm_group, sys_perm_other=:ClientTemplate_sys_perm_other, template_name=:ClientTemplate_template_name, template_type=:ClientTemplate_template_type, limit_maildomain=:ClientTemplate_limit_maildomain, limit_mailbox=:ClientTemplate_limit_mailbox, limit_mailalias=:ClientTemplate_limit_mailalias, limit_mailaliasdomain=:ClientTemplate_limit_mailaliasdomain, limit_mailforward=:ClientTemplate_limit_mailforward, limit_mailcatchall=:ClientTemplate_limit_mailcatchall, limit_mailrouting=:ClientTemplate_limit_mailrouting, limit_mailfilter=:ClientTemplate_limit_mailfilter, limit_fetchmail=:ClientTemplate_limit_fetchmail, limit_mailquota=:ClientTemplate_limit_mailquota, limit_spamfilter_wblist=:ClientTemplate_limit_spamfilter_wblist, limit_spamfilter_user=:ClientTemplate_limit_spamfilter_user, limit_spamfilter_policy=:ClientTemplate_limit_spamfilter_policy, limit_web_ip=:ClientTemplate_limit_web_ip, limit_web_domain=:ClientTemplate_limit_web_domain, limit_web_quota=:ClientTemplate_limit_web_quota, web_php_options=:ClientTemplate_web_php_options, limit_cgi=:ClientTemplate_limit_cgi, limit_ssi=:ClientTemplate_limit_ssi, limit_perl=:ClientTemplate_limit_perl, limit_ruby=:ClientTemplate_limit_ruby, limit_python=:ClientTemplate_limit_python, force_suexec=:ClientTemplate_force_suexec, limit_hterror=:ClientTemplate_limit_hterror, limit_wildcard=:ClientTemplate_limit_wildcard, limit_ssl=:ClientTemplate_limit_ssl, limit_web_subdomain=:ClientTemplate_limit_web_subdomain, limit_web_aliasdomain=:ClientTemplate_limit_web_aliasdomain, limit_ftp_user=:ClientTemplate_limit_ftp_user, limit_shell_user=:ClientTemplate_limit_shell_user, ssh_chroot=:ClientTemplate_ssh_chroot, limit_webdav_user=:ClientTemplate_limit_webdav_user, limit_backup=:ClientTemplate_limit_backup, limit_aps=:ClientTemplate_limit_aps, limit_dns_zone=:ClientTemplate_limit_dns_zone, limit_dns_slave_zone=:ClientTemplate_limit_dns_slave_zone, limit_dns_record=:ClientTemplate_limit_dns_record, limit_database=:ClientTemplate_limit_database, limit_database_quota=:ClientTemplate_limit_database_quota, limit_cron=:ClientTemplate_limit_cron, limit_cron_type=:ClientTemplate_limit_cron_type, limit_cron_frequency=:ClientTemplate_limit_cron_frequency, limit_traffic_quota=:ClientTemplate_limit_traffic_quota, limit_client=:ClientTemplate_limit_client, limit_domainmodule=:ClientTemplate_limit_domainmodule, limit_mailmailinglist=:ClientTemplate_limit_mailmailinglist, limit_openvz_vm=:ClientTemplate_limit_openvz_vm, limit_openvz_vm_template_id=:ClientTemplate_limit_openvz_vm_template_id WHERE template_id=:ClientTemplate_template_id", use(clienttemplate);
}

void ClientTemplateRepository::update(const ClientTemplate& oldObj, const ClientTemplate& newObj)
{
	dataBase << "update client_template set template_id=:ClientTemplate_template_id, sys_userid=:ClientTemplate_sys_userid, sys_groupid=:ClientTemplate_sys_groupid, sys_perm_user=:ClientTemplate_sys_perm_user, sys_perm_group=:ClientTemplate_sys_perm_group, sys_perm_other=:ClientTemplate_sys_perm_other, template_name=:ClientTemplate_template_name, template_type=:ClientTemplate_template_type, limit_maildomain=:ClientTemplate_limit_maildomain, limit_mailbox=:ClientTemplate_limit_mailbox, limit_mailalias=:ClientTemplate_limit_mailalias, limit_mailaliasdomain=:ClientTemplate_limit_mailaliasdomain, limit_mailforward=:ClientTemplate_limit_mailforward, limit_mailcatchall=:ClientTemplate_limit_mailcatchall, limit_mailrouting=:ClientTemplate_limit_mailrouting, limit_mailfilter=:ClientTemplate_limit_mailfilter, limit_fetchmail=:ClientTemplate_limit_fetchmail, limit_mailquota=:ClientTemplate_limit_mailquota, limit_spamfilter_wblist=:ClientTemplate_limit_spamfilter_wblist, limit_spamfilter_user=:ClientTemplate_limit_spamfilter_user, limit_spamfilter_policy=:ClientTemplate_limit_spamfilter_policy, limit_web_ip=:ClientTemplate_limit_web_ip, limit_web_domain=:ClientTemplate_limit_web_domain, limit_web_quota=:ClientTemplate_limit_web_quota, web_php_options=:ClientTemplate_web_php_options, limit_cgi=:ClientTemplate_limit_cgi, limit_ssi=:ClientTemplate_limit_ssi, limit_perl=:ClientTemplate_limit_perl, limit_ruby=:ClientTemplate_limit_ruby, limit_python=:ClientTemplate_limit_python, force_suexec=:ClientTemplate_force_suexec, limit_hterror=:ClientTemplate_limit_hterror, limit_wildcard=:ClientTemplate_limit_wildcard, limit_ssl=:ClientTemplate_limit_ssl, limit_web_subdomain=:ClientTemplate_limit_web_subdomain, limit_web_aliasdomain=:ClientTemplate_limit_web_aliasdomain, limit_ftp_user=:ClientTemplate_limit_ftp_user, limit_shell_user=:ClientTemplate_limit_shell_user, ssh_chroot=:ClientTemplate_ssh_chroot, limit_webdav_user=:ClientTemplate_limit_webdav_user, limit_backup=:ClientTemplate_limit_backup, limit_aps=:ClientTemplate_limit_aps, limit_dns_zone=:ClientTemplate_limit_dns_zone, limit_dns_slave_zone=:ClientTemplate_limit_dns_slave_zone, limit_dns_record=:ClientTemplate_limit_dns_record, limit_database=:ClientTemplate_limit_database, limit_database_quota=:ClientTemplate_limit_database_quota, limit_cron=:ClientTemplate_limit_cron, limit_cron_type=:ClientTemplate_limit_cron_type, limit_cron_frequency=:ClientTemplate_limit_cron_frequency, limit_traffic_quota=:ClientTemplate_limit_traffic_quota, limit_client=:ClientTemplate_limit_client, limit_domainmodule=:ClientTemplate_limit_domainmodule, limit_mailmailinglist=:ClientTemplate_limit_mailmailinglist, limit_openvz_vm=:ClientTemplate_limit_openvz_vm, limit_openvz_vm_template_id=:ClientTemplate_limit_openvz_vm_template_id WHERE template_id='"<<oldObj.getTemplateId()<<"\'", use(newObj);
}

