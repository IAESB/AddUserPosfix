#include "clientrepository.h"
#include "util.hpp"
ClientRepository::ClientRepository(soci::session& db) : dataBase(db)
{
}

ClientPtr ClientRepository::select(const Client& obj)
{
	soci::row row;
	ClientPtr client(new Client);
	dataBase << "SELECT  client.client_id as Client_client_id, client.sys_userid as Client_sys_userid, client.sys_groupid as Client_sys_groupid, client.sys_perm_user as Client_sys_perm_user, client.sys_perm_group as Client_sys_perm_group, client.sys_perm_other as Client_sys_perm_other, client.company_name as Client_company_name, client.company_id as Client_company_id, client.gender as Client_gender, client.contact_name as Client_contact_name, client.customer_no as Client_customer_no, client.vat_id as Client_vat_id, client.street as Client_street, client.zip as Client_zip, client.city as Client_city, client.state as Client_state, client.country as Client_country, client.telephone as Client_telephone, client.mobile as Client_mobile, client.fax as Client_fax, client.email as Client_email, client.internet as Client_internet, client.icq as Client_icq, client.notes as Client_notes, client.bank_account_owner as Client_bank_account_owner, client.bank_account_number as Client_bank_account_number, client.bank_code as Client_bank_code, client.bank_name as Client_bank_name, client.bank_account_iban as Client_bank_account_iban, client.bank_account_swift as Client_bank_account_swift, client.paypal_email as Client_paypal_email, client.default_mailserver as Client_default_mailserver, client.mail_servers as Client_mail_servers, client.limit_maildomain as Client_limit_maildomain, client.limit_mailbox as Client_limit_mailbox, client.limit_mailalias as Client_limit_mailalias, client.limit_mailaliasdomain as Client_limit_mailaliasdomain, client.limit_mailforward as Client_limit_mailforward, client.limit_mailcatchall as Client_limit_mailcatchall, client.limit_mailrouting as Client_limit_mailrouting, client.limit_mailfilter as Client_limit_mailfilter, client.limit_fetchmail as Client_limit_fetchmail, client.limit_mailquota as Client_limit_mailquota, client.limit_spamfilter_wblist as Client_limit_spamfilter_wblist, client.limit_spamfilter_user as Client_limit_spamfilter_user, client.limit_spamfilter_policy as Client_limit_spamfilter_policy, client.default_webserver as Client_default_webserver, client.web_servers as Client_web_servers, client.limit_web_ip as Client_limit_web_ip, client.limit_web_domain as Client_limit_web_domain, client.limit_web_quota as Client_limit_web_quota, client.web_php_options as Client_web_php_options, client.limit_cgi as Client_limit_cgi, client.limit_ssi as Client_limit_ssi, client.limit_perl as Client_limit_perl, client.limit_ruby as Client_limit_ruby, client.limit_python as Client_limit_python, client.force_suexec as Client_force_suexec, client.limit_hterror as Client_limit_hterror, client.limit_wildcard as Client_limit_wildcard, client.limit_ssl as Client_limit_ssl, client.limit_web_subdomain as Client_limit_web_subdomain, client.limit_web_aliasdomain as Client_limit_web_aliasdomain, client.limit_ftp_user as Client_limit_ftp_user, client.limit_shell_user as Client_limit_shell_user, client.ssh_chroot as Client_ssh_chroot, client.limit_webdav_user as Client_limit_webdav_user, client.limit_backup as Client_limit_backup, client.limit_aps as Client_limit_aps, client.default_dnsserver as Client_default_dnsserver, client.db_servers as Client_db_servers, client.limit_dns_zone as Client_limit_dns_zone, client.default_slave_dnsserver as Client_default_slave_dnsserver, client.limit_dns_slave_zone as Client_limit_dns_slave_zone, client.limit_dns_record as Client_limit_dns_record, client.default_dbserver as Client_default_dbserver, client.dns_servers as Client_dns_servers, client.limit_database as Client_limit_database, client.limit_database_quota as Client_limit_database_quota, client.limit_cron as Client_limit_cron, client.limit_cron_type as Client_limit_cron_type, client.limit_cron_frequency as Client_limit_cron_frequency, client.limit_traffic_quota as Client_limit_traffic_quota, client.limit_client as Client_limit_client, client.limit_domainmodule as Client_limit_domainmodule, client.limit_mailmailinglist as Client_limit_mailmailinglist, client.limit_openvz_vm as Client_limit_openvz_vm, client.limit_openvz_vm_template_id as Client_limit_openvz_vm_template_id, client.parent_client_id as Client_parent_client_id, client.username as Client_username, client.password as Client_password, client.language as Client_language, client.usertheme as Client_usertheme, client.template_master as Client_template_master, client.template_additional as Client_template_additional, client.created_at as Client_created_at, client.locked as Client_locked, client.canceled as Client_canceled, client.can_use_api as Client_can_use_api, client.tmp_data as Client_tmp_data, client.id_rsa as Client_id_rsa, client.ssh_rsa as Client_ssh_rsa, client.customer_no_template as Client_customer_no_template, client.customer_no_start as Client_customer_no_start, client.customer_no_counter as Client_customer_no_counter, client.added_date as Client_added_date, client.added_by as Client_added_by"
	" FROM client "
	"WHERE client.client_id = :Client_client_id", into(row), use(obj);
	if(!dataBase.got_data())
		client.reset();
	else
		type_conversion<Client>::from_base(row, i_ok, *client);
	return client;
}
ClientList ClientRepository::select(const string& where)
{
	soci::rowset<row> rs = 	dataBase.prepare << "SELECT  client.client_id as Client_client_id, client.sys_userid as Client_sys_userid, client.sys_groupid as Client_sys_groupid, client.sys_perm_user as Client_sys_perm_user, client.sys_perm_group as Client_sys_perm_group, client.sys_perm_other as Client_sys_perm_other, client.company_name as Client_company_name, client.company_id as Client_company_id, client.gender as Client_gender, client.contact_name as Client_contact_name, client.customer_no as Client_customer_no, client.vat_id as Client_vat_id, client.street as Client_street, client.zip as Client_zip, client.city as Client_city, client.state as Client_state, client.country as Client_country, client.telephone as Client_telephone, client.mobile as Client_mobile, client.fax as Client_fax, client.email as Client_email, client.internet as Client_internet, client.icq as Client_icq, client.notes as Client_notes, client.bank_account_owner as Client_bank_account_owner, client.bank_account_number as Client_bank_account_number, client.bank_code as Client_bank_code, client.bank_name as Client_bank_name, client.bank_account_iban as Client_bank_account_iban, client.bank_account_swift as Client_bank_account_swift, client.paypal_email as Client_paypal_email, client.default_mailserver as Client_default_mailserver, client.mail_servers as Client_mail_servers, client.limit_maildomain as Client_limit_maildomain, client.limit_mailbox as Client_limit_mailbox, client.limit_mailalias as Client_limit_mailalias, client.limit_mailaliasdomain as Client_limit_mailaliasdomain, client.limit_mailforward as Client_limit_mailforward, client.limit_mailcatchall as Client_limit_mailcatchall, client.limit_mailrouting as Client_limit_mailrouting, client.limit_mailfilter as Client_limit_mailfilter, client.limit_fetchmail as Client_limit_fetchmail, client.limit_mailquota as Client_limit_mailquota, client.limit_spamfilter_wblist as Client_limit_spamfilter_wblist, client.limit_spamfilter_user as Client_limit_spamfilter_user, client.limit_spamfilter_policy as Client_limit_spamfilter_policy, client.default_webserver as Client_default_webserver, client.web_servers as Client_web_servers, client.limit_web_ip as Client_limit_web_ip, client.limit_web_domain as Client_limit_web_domain, client.limit_web_quota as Client_limit_web_quota, client.web_php_options as Client_web_php_options, client.limit_cgi as Client_limit_cgi, client.limit_ssi as Client_limit_ssi, client.limit_perl as Client_limit_perl, client.limit_ruby as Client_limit_ruby, client.limit_python as Client_limit_python, client.force_suexec as Client_force_suexec, client.limit_hterror as Client_limit_hterror, client.limit_wildcard as Client_limit_wildcard, client.limit_ssl as Client_limit_ssl, client.limit_web_subdomain as Client_limit_web_subdomain, client.limit_web_aliasdomain as Client_limit_web_aliasdomain, client.limit_ftp_user as Client_limit_ftp_user, client.limit_shell_user as Client_limit_shell_user, client.ssh_chroot as Client_ssh_chroot, client.limit_webdav_user as Client_limit_webdav_user, client.limit_backup as Client_limit_backup, client.limit_aps as Client_limit_aps, client.default_dnsserver as Client_default_dnsserver, client.db_servers as Client_db_servers, client.limit_dns_zone as Client_limit_dns_zone, client.default_slave_dnsserver as Client_default_slave_dnsserver, client.limit_dns_slave_zone as Client_limit_dns_slave_zone, client.limit_dns_record as Client_limit_dns_record, client.default_dbserver as Client_default_dbserver, client.dns_servers as Client_dns_servers, client.limit_database as Client_limit_database, client.limit_database_quota as Client_limit_database_quota, client.limit_cron as Client_limit_cron, client.limit_cron_type as Client_limit_cron_type, client.limit_cron_frequency as Client_limit_cron_frequency, client.limit_traffic_quota as Client_limit_traffic_quota, client.limit_client as Client_limit_client, client.limit_domainmodule as Client_limit_domainmodule, client.limit_mailmailinglist as Client_limit_mailmailinglist, client.limit_openvz_vm as Client_limit_openvz_vm, client.limit_openvz_vm_template_id as Client_limit_openvz_vm_template_id, client.parent_client_id as Client_parent_client_id, client.username as Client_username, client.password as Client_password, client.language as Client_language, client.usertheme as Client_usertheme, client.template_master as Client_template_master, client.template_additional as Client_template_additional, client.created_at as Client_created_at, client.locked as Client_locked, client.canceled as Client_canceled, client.can_use_api as Client_can_use_api, client.tmp_data as Client_tmp_data, client.id_rsa as Client_id_rsa, client.ssh_rsa as Client_ssh_rsa, client.customer_no_template as Client_customer_no_template, client.customer_no_start as Client_customer_no_start, client.customer_no_counter as Client_customer_no_counter, client.added_date as Client_added_date, client.added_by as Client_added_by "
	" FROM client" 
	<< (where.size()?" WHERE "+where:"");
	ClientList clientList;
	for(row& r: rs)
	{
		ClientPtr client(new Client);
		type_conversion<Client>::from_base(r, i_ok, *client);
		clientList.push_back(client);
	}
	return clientList;
}

int ClientRepository::insert(const Client& client)
{
	dataBase << "insert into client(client_id, sys_userid, sys_groupid, sys_perm_user, sys_perm_group, sys_perm_other, company_name, company_id, gender, contact_name, customer_no, vat_id, street, zip, city, state, country, telephone, mobile, fax, email, internet, icq, notes, bank_account_owner, bank_account_number, bank_code, bank_name, bank_account_iban, bank_account_swift, paypal_email, default_mailserver, mail_servers, limit_maildomain, limit_mailbox, limit_mailalias, limit_mailaliasdomain, limit_mailforward, limit_mailcatchall, limit_mailrouting, limit_mailfilter, limit_fetchmail, limit_mailquota, limit_spamfilter_wblist, limit_spamfilter_user, limit_spamfilter_policy, default_webserver, web_servers, limit_web_ip, limit_web_domain, limit_web_quota, web_php_options, limit_cgi, limit_ssi, limit_perl, limit_ruby, limit_python, force_suexec, limit_hterror, limit_wildcard, limit_ssl, limit_web_subdomain, limit_web_aliasdomain, limit_ftp_user, limit_shell_user, ssh_chroot, limit_webdav_user, limit_backup, limit_aps, default_dnsserver, db_servers, limit_dns_zone, default_slave_dnsserver, limit_dns_slave_zone, limit_dns_record, default_dbserver, dns_servers, limit_database, limit_database_quota, limit_cron, limit_cron_type, limit_cron_frequency, limit_traffic_quota, limit_client, limit_domainmodule, limit_mailmailinglist, limit_openvz_vm, limit_openvz_vm_template_id, parent_client_id, username, password, language, usertheme, template_master, template_additional, created_at, locked, canceled, can_use_api, tmp_data, id_rsa, ssh_rsa, customer_no_template, customer_no_start, customer_no_counter, added_date, added_by)\
values(:Client_client_id, :Client_sys_userid, :Client_sys_groupid, :Client_sys_perm_user, :Client_sys_perm_group, :Client_sys_perm_other, :Client_company_name, :Client_company_id, :Client_gender, :Client_contact_name, :Client_customer_no, :Client_vat_id, :Client_street, :Client_zip, :Client_city, :Client_state, :Client_country, :Client_telephone, :Client_mobile, :Client_fax, :Client_email, :Client_internet, :Client_icq, :Client_notes, :Client_bank_account_owner, :Client_bank_account_number, :Client_bank_code, :Client_bank_name, :Client_bank_account_iban, :Client_bank_account_swift, :Client_paypal_email, :Client_default_mailserver, :Client_mail_servers, :Client_limit_maildomain, :Client_limit_mailbox, :Client_limit_mailalias, :Client_limit_mailaliasdomain, :Client_limit_mailforward, :Client_limit_mailcatchall, :Client_limit_mailrouting, :Client_limit_mailfilter, :Client_limit_fetchmail, :Client_limit_mailquota, :Client_limit_spamfilter_wblist, :Client_limit_spamfilter_user, :Client_limit_spamfilter_policy, :Client_default_webserver, :Client_web_servers, :Client_limit_web_ip, :Client_limit_web_domain, :Client_limit_web_quota, :Client_web_php_options, :Client_limit_cgi, :Client_limit_ssi, :Client_limit_perl, :Client_limit_ruby, :Client_limit_python, :Client_force_suexec, :Client_limit_hterror, :Client_limit_wildcard, :Client_limit_ssl, :Client_limit_web_subdomain, :Client_limit_web_aliasdomain, :Client_limit_ftp_user, :Client_limit_shell_user, :Client_ssh_chroot, :Client_limit_webdav_user, :Client_limit_backup, :Client_limit_aps, :Client_default_dnsserver, :Client_db_servers, :Client_limit_dns_zone, :Client_default_slave_dnsserver, :Client_limit_dns_slave_zone, :Client_limit_dns_record, :Client_default_dbserver, :Client_dns_servers, :Client_limit_database, :Client_limit_database_quota, :Client_limit_cron, :Client_limit_cron_type, :Client_limit_cron_frequency, :Client_limit_traffic_quota, :Client_limit_client, :Client_limit_domainmodule, :Client_limit_mailmailinglist, :Client_limit_openvz_vm, :Client_limit_openvz_vm_template_id, :Client_parent_client_id, :Client_username, :Client_password, :Client_language, :Client_usertheme, :Client_template_master, :Client_template_additional, :Client_created_at, :Client_locked, :Client_canceled, :Client_can_use_api, :Client_tmp_data, :Client_id_rsa, :Client_ssh_rsa, :Client_customer_no_template, :Client_customer_no_start, :Client_customer_no_counter, :Client_added_date, :Client_added_by)", use(client);
	int id=0;
	dataBase << "SELECT LAST_INSERT_ID()", soci::into(id);
	return id;
}

void ClientRepository::remove(const Client& client)
{
	dataBase << "DELETE from client WHERE client_id=:Client_client_id", use(client);
}

void ClientRepository::update(const Client& client)
{
	dataBase << "update client set client_id=:Client_client_id, sys_userid=:Client_sys_userid, sys_groupid=:Client_sys_groupid, sys_perm_user=:Client_sys_perm_user, sys_perm_group=:Client_sys_perm_group, sys_perm_other=:Client_sys_perm_other, company_name=:Client_company_name, company_id=:Client_company_id, gender=:Client_gender, contact_name=:Client_contact_name, customer_no=:Client_customer_no, vat_id=:Client_vat_id, street=:Client_street, zip=:Client_zip, city=:Client_city, state=:Client_state, country=:Client_country, telephone=:Client_telephone, mobile=:Client_mobile, fax=:Client_fax, email=:Client_email, internet=:Client_internet, icq=:Client_icq, notes=:Client_notes, bank_account_owner=:Client_bank_account_owner, bank_account_number=:Client_bank_account_number, bank_code=:Client_bank_code, bank_name=:Client_bank_name, bank_account_iban=:Client_bank_account_iban, bank_account_swift=:Client_bank_account_swift, paypal_email=:Client_paypal_email, default_mailserver=:Client_default_mailserver, mail_servers=:Client_mail_servers, limit_maildomain=:Client_limit_maildomain, limit_mailbox=:Client_limit_mailbox, limit_mailalias=:Client_limit_mailalias, limit_mailaliasdomain=:Client_limit_mailaliasdomain, limit_mailforward=:Client_limit_mailforward, limit_mailcatchall=:Client_limit_mailcatchall, limit_mailrouting=:Client_limit_mailrouting, limit_mailfilter=:Client_limit_mailfilter, limit_fetchmail=:Client_limit_fetchmail, limit_mailquota=:Client_limit_mailquota, limit_spamfilter_wblist=:Client_limit_spamfilter_wblist, limit_spamfilter_user=:Client_limit_spamfilter_user, limit_spamfilter_policy=:Client_limit_spamfilter_policy, default_webserver=:Client_default_webserver, web_servers=:Client_web_servers, limit_web_ip=:Client_limit_web_ip, limit_web_domain=:Client_limit_web_domain, limit_web_quota=:Client_limit_web_quota, web_php_options=:Client_web_php_options, limit_cgi=:Client_limit_cgi, limit_ssi=:Client_limit_ssi, limit_perl=:Client_limit_perl, limit_ruby=:Client_limit_ruby, limit_python=:Client_limit_python, force_suexec=:Client_force_suexec, limit_hterror=:Client_limit_hterror, limit_wildcard=:Client_limit_wildcard, limit_ssl=:Client_limit_ssl, limit_web_subdomain=:Client_limit_web_subdomain, limit_web_aliasdomain=:Client_limit_web_aliasdomain, limit_ftp_user=:Client_limit_ftp_user, limit_shell_user=:Client_limit_shell_user, ssh_chroot=:Client_ssh_chroot, limit_webdav_user=:Client_limit_webdav_user, limit_backup=:Client_limit_backup, limit_aps=:Client_limit_aps, default_dnsserver=:Client_default_dnsserver, db_servers=:Client_db_servers, limit_dns_zone=:Client_limit_dns_zone, default_slave_dnsserver=:Client_default_slave_dnsserver, limit_dns_slave_zone=:Client_limit_dns_slave_zone, limit_dns_record=:Client_limit_dns_record, default_dbserver=:Client_default_dbserver, dns_servers=:Client_dns_servers, limit_database=:Client_limit_database, limit_database_quota=:Client_limit_database_quota, limit_cron=:Client_limit_cron, limit_cron_type=:Client_limit_cron_type, limit_cron_frequency=:Client_limit_cron_frequency, limit_traffic_quota=:Client_limit_traffic_quota, limit_client=:Client_limit_client, limit_domainmodule=:Client_limit_domainmodule, limit_mailmailinglist=:Client_limit_mailmailinglist, limit_openvz_vm=:Client_limit_openvz_vm, limit_openvz_vm_template_id=:Client_limit_openvz_vm_template_id, parent_client_id=:Client_parent_client_id, username=:Client_username, password=:Client_password, language=:Client_language, usertheme=:Client_usertheme, template_master=:Client_template_master, template_additional=:Client_template_additional, created_at=:Client_created_at, locked=:Client_locked, canceled=:Client_canceled, can_use_api=:Client_can_use_api, tmp_data=:Client_tmp_data, id_rsa=:Client_id_rsa, ssh_rsa=:Client_ssh_rsa, customer_no_template=:Client_customer_no_template, customer_no_start=:Client_customer_no_start, customer_no_counter=:Client_customer_no_counter, added_date=:Client_added_date, added_by=:Client_added_by WHERE client_id=:Client_client_id", use(client);
}

void ClientRepository::update(const Client& oldObj, const Client& newObj)
{
	dataBase << "update client set client_id=:Client_client_id, sys_userid=:Client_sys_userid, sys_groupid=:Client_sys_groupid, sys_perm_user=:Client_sys_perm_user, sys_perm_group=:Client_sys_perm_group, sys_perm_other=:Client_sys_perm_other, company_name=:Client_company_name, company_id=:Client_company_id, gender=:Client_gender, contact_name=:Client_contact_name, customer_no=:Client_customer_no, vat_id=:Client_vat_id, street=:Client_street, zip=:Client_zip, city=:Client_city, state=:Client_state, country=:Client_country, telephone=:Client_telephone, mobile=:Client_mobile, fax=:Client_fax, email=:Client_email, internet=:Client_internet, icq=:Client_icq, notes=:Client_notes, bank_account_owner=:Client_bank_account_owner, bank_account_number=:Client_bank_account_number, bank_code=:Client_bank_code, bank_name=:Client_bank_name, bank_account_iban=:Client_bank_account_iban, bank_account_swift=:Client_bank_account_swift, paypal_email=:Client_paypal_email, default_mailserver=:Client_default_mailserver, mail_servers=:Client_mail_servers, limit_maildomain=:Client_limit_maildomain, limit_mailbox=:Client_limit_mailbox, limit_mailalias=:Client_limit_mailalias, limit_mailaliasdomain=:Client_limit_mailaliasdomain, limit_mailforward=:Client_limit_mailforward, limit_mailcatchall=:Client_limit_mailcatchall, limit_mailrouting=:Client_limit_mailrouting, limit_mailfilter=:Client_limit_mailfilter, limit_fetchmail=:Client_limit_fetchmail, limit_mailquota=:Client_limit_mailquota, limit_spamfilter_wblist=:Client_limit_spamfilter_wblist, limit_spamfilter_user=:Client_limit_spamfilter_user, limit_spamfilter_policy=:Client_limit_spamfilter_policy, default_webserver=:Client_default_webserver, web_servers=:Client_web_servers, limit_web_ip=:Client_limit_web_ip, limit_web_domain=:Client_limit_web_domain, limit_web_quota=:Client_limit_web_quota, web_php_options=:Client_web_php_options, limit_cgi=:Client_limit_cgi, limit_ssi=:Client_limit_ssi, limit_perl=:Client_limit_perl, limit_ruby=:Client_limit_ruby, limit_python=:Client_limit_python, force_suexec=:Client_force_suexec, limit_hterror=:Client_limit_hterror, limit_wildcard=:Client_limit_wildcard, limit_ssl=:Client_limit_ssl, limit_web_subdomain=:Client_limit_web_subdomain, limit_web_aliasdomain=:Client_limit_web_aliasdomain, limit_ftp_user=:Client_limit_ftp_user, limit_shell_user=:Client_limit_shell_user, ssh_chroot=:Client_ssh_chroot, limit_webdav_user=:Client_limit_webdav_user, limit_backup=:Client_limit_backup, limit_aps=:Client_limit_aps, default_dnsserver=:Client_default_dnsserver, db_servers=:Client_db_servers, limit_dns_zone=:Client_limit_dns_zone, default_slave_dnsserver=:Client_default_slave_dnsserver, limit_dns_slave_zone=:Client_limit_dns_slave_zone, limit_dns_record=:Client_limit_dns_record, default_dbserver=:Client_default_dbserver, dns_servers=:Client_dns_servers, limit_database=:Client_limit_database, limit_database_quota=:Client_limit_database_quota, limit_cron=:Client_limit_cron, limit_cron_type=:Client_limit_cron_type, limit_cron_frequency=:Client_limit_cron_frequency, limit_traffic_quota=:Client_limit_traffic_quota, limit_client=:Client_limit_client, limit_domainmodule=:Client_limit_domainmodule, limit_mailmailinglist=:Client_limit_mailmailinglist, limit_openvz_vm=:Client_limit_openvz_vm, limit_openvz_vm_template_id=:Client_limit_openvz_vm_template_id, parent_client_id=:Client_parent_client_id, username=:Client_username, password=:Client_password, language=:Client_language, usertheme=:Client_usertheme, template_master=:Client_template_master, template_additional=:Client_template_additional, created_at=:Client_created_at, locked=:Client_locked, canceled=:Client_canceled, can_use_api=:Client_can_use_api, tmp_data=:Client_tmp_data, id_rsa=:Client_id_rsa, ssh_rsa=:Client_ssh_rsa, customer_no_template=:Client_customer_no_template, customer_no_start=:Client_customer_no_start, customer_no_counter=:Client_customer_no_counter, added_date=:Client_added_date, added_by=:Client_added_by WHERE client_id='"<<oldObj.getClientId()<<"\'", use(newObj);
}

