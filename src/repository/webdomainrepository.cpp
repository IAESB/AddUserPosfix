#include "webdomainrepository.h"
#include "util.hpp"
WebDomainRepository::WebDomainRepository(soci::session& db) : dataBase(db)
{
}

WebDomainPtr WebDomainRepository::select(const WebDomain& obj)
{
	soci::row row;
	WebDomainPtr webdomain(new WebDomain);
	dataBase << "SELECT  web_domain.domain_id as WebDomain_domain_id, web_domain.sys_userid as WebDomain_sys_userid, web_domain.sys_groupid as WebDomain_sys_groupid, web_domain.sys_perm_user as WebDomain_sys_perm_user, web_domain.sys_perm_group as WebDomain_sys_perm_group, web_domain.sys_perm_other as WebDomain_sys_perm_other, web_domain.server_id as WebDomain_server_id, web_domain.ip_address as WebDomain_ip_address, web_domain.ipv6_address as WebDomain_ipv6_address, web_domain.domain as WebDomain_domain, web_domain.type as WebDomain_type, web_domain.parent_domain_id as WebDomain_parent_domain_id, web_domain.vhost_type as WebDomain_vhost_type, web_domain.document_root as WebDomain_document_root, web_domain.web_folder as WebDomain_web_folder, web_domain.system_user as WebDomain_system_user, web_domain.system_group as WebDomain_system_group, web_domain.hd_quota as WebDomain_hd_quota, web_domain.traffic_quota as WebDomain_traffic_quota, web_domain.cgi as WebDomain_cgi, web_domain.ssi as WebDomain_ssi, web_domain.suexec as WebDomain_suexec, web_domain.errordocs as WebDomain_errordocs, web_domain.is_subdomainwww as WebDomain_is_subdomainwww, web_domain.subdomain as WebDomain_subdomain, web_domain.php as WebDomain_php, web_domain.ruby as WebDomain_ruby, web_domain.python as WebDomain_python, web_domain.perl as WebDomain_perl, web_domain.redirect_type as WebDomain_redirect_type, web_domain.redirect_path as WebDomain_redirect_path, web_domain.seo_redirect as WebDomain_seo_redirect, web_domain.ssl as WebDomain_ssl, web_domain.ssl_state as WebDomain_ssl_state, web_domain.ssl_locality as WebDomain_ssl_locality, web_domain.ssl_organisation as WebDomain_ssl_organisation, web_domain.ssl_organisation_unit as WebDomain_ssl_organisation_unit, web_domain.ssl_country as WebDomain_ssl_country, web_domain.ssl_domain as WebDomain_ssl_domain, web_domain.ssl_request as WebDomain_ssl_request, web_domain.ssl_cert as WebDomain_ssl_cert, web_domain.ssl_bundle as WebDomain_ssl_bundle, web_domain.ssl_key as WebDomain_ssl_key, web_domain.ssl_action as WebDomain_ssl_action, web_domain.stats_password as WebDomain_stats_password, web_domain.stats_type as WebDomain_stats_type, web_domain.allow_override as WebDomain_allow_override, web_domain.apache_directives as WebDomain_apache_directives, web_domain.nginx_directives as WebDomain_nginx_directives, web_domain.php_fpm_use_socket as WebDomain_php_fpm_use_socket, web_domain.pm as WebDomain_pm, web_domain.pm_max_children as WebDomain_pm_max_children, web_domain.pm_start_servers as WebDomain_pm_start_servers, web_domain.pm_min_spare_servers as WebDomain_pm_min_spare_servers, web_domain.pm_max_spare_servers as WebDomain_pm_max_spare_servers, web_domain.pm_process_idle_timeout as WebDomain_pm_process_idle_timeout, web_domain.pm_max_requests as WebDomain_pm_max_requests, web_domain.php_open_basedir as WebDomain_php_open_basedir, web_domain.custom_php_ini as WebDomain_custom_php_ini, web_domain.backup_interval as WebDomain_backup_interval, web_domain.backup_copies as WebDomain_backup_copies, web_domain.backup_excludes as WebDomain_backup_excludes, web_domain.active as WebDomain_active, web_domain.traffic_quota_lock as WebDomain_traffic_quota_lock, web_domain.fastcgi_php_version as WebDomain_fastcgi_php_version, web_domain.proxy_directives as WebDomain_proxy_directives, web_domain.last_quota_notification as WebDomain_last_quota_notification, web_domain.rewrite_rules as WebDomain_rewrite_rules, web_domain.added_date as WebDomain_added_date, web_domain.added_by as WebDomain_added_by"
	" FROM web_domain "
	"WHERE web_domain.domain_id = :WebDomain_domain_id AND web_domain.server_id = :WebDomain_server_id", into(row), use(obj);
	if(!dataBase.got_data())
		webdomain.reset();
	else
		type_conversion<WebDomain>::from_base(row, i_ok, *webdomain);
	return webdomain;
}
WebDomainList WebDomainRepository::select(const string& where)
{
	soci::rowset<row> rs = 	dataBase.prepare << "SELECT  web_domain.domain_id as WebDomain_domain_id, web_domain.sys_userid as WebDomain_sys_userid, web_domain.sys_groupid as WebDomain_sys_groupid, web_domain.sys_perm_user as WebDomain_sys_perm_user, web_domain.sys_perm_group as WebDomain_sys_perm_group, web_domain.sys_perm_other as WebDomain_sys_perm_other, web_domain.server_id as WebDomain_server_id, web_domain.ip_address as WebDomain_ip_address, web_domain.ipv6_address as WebDomain_ipv6_address, web_domain.domain as WebDomain_domain, web_domain.type as WebDomain_type, web_domain.parent_domain_id as WebDomain_parent_domain_id, web_domain.vhost_type as WebDomain_vhost_type, web_domain.document_root as WebDomain_document_root, web_domain.web_folder as WebDomain_web_folder, web_domain.system_user as WebDomain_system_user, web_domain.system_group as WebDomain_system_group, web_domain.hd_quota as WebDomain_hd_quota, web_domain.traffic_quota as WebDomain_traffic_quota, web_domain.cgi as WebDomain_cgi, web_domain.ssi as WebDomain_ssi, web_domain.suexec as WebDomain_suexec, web_domain.errordocs as WebDomain_errordocs, web_domain.is_subdomainwww as WebDomain_is_subdomainwww, web_domain.subdomain as WebDomain_subdomain, web_domain.php as WebDomain_php, web_domain.ruby as WebDomain_ruby, web_domain.python as WebDomain_python, web_domain.perl as WebDomain_perl, web_domain.redirect_type as WebDomain_redirect_type, web_domain.redirect_path as WebDomain_redirect_path, web_domain.seo_redirect as WebDomain_seo_redirect, web_domain.ssl as WebDomain_ssl, web_domain.ssl_state as WebDomain_ssl_state, web_domain.ssl_locality as WebDomain_ssl_locality, web_domain.ssl_organisation as WebDomain_ssl_organisation, web_domain.ssl_organisation_unit as WebDomain_ssl_organisation_unit, web_domain.ssl_country as WebDomain_ssl_country, web_domain.ssl_domain as WebDomain_ssl_domain, web_domain.ssl_request as WebDomain_ssl_request, web_domain.ssl_cert as WebDomain_ssl_cert, web_domain.ssl_bundle as WebDomain_ssl_bundle, web_domain.ssl_key as WebDomain_ssl_key, web_domain.ssl_action as WebDomain_ssl_action, web_domain.stats_password as WebDomain_stats_password, web_domain.stats_type as WebDomain_stats_type, web_domain.allow_override as WebDomain_allow_override, web_domain.apache_directives as WebDomain_apache_directives, web_domain.nginx_directives as WebDomain_nginx_directives, web_domain.php_fpm_use_socket as WebDomain_php_fpm_use_socket, web_domain.pm as WebDomain_pm, web_domain.pm_max_children as WebDomain_pm_max_children, web_domain.pm_start_servers as WebDomain_pm_start_servers, web_domain.pm_min_spare_servers as WebDomain_pm_min_spare_servers, web_domain.pm_max_spare_servers as WebDomain_pm_max_spare_servers, web_domain.pm_process_idle_timeout as WebDomain_pm_process_idle_timeout, web_domain.pm_max_requests as WebDomain_pm_max_requests, web_domain.php_open_basedir as WebDomain_php_open_basedir, web_domain.custom_php_ini as WebDomain_custom_php_ini, web_domain.backup_interval as WebDomain_backup_interval, web_domain.backup_copies as WebDomain_backup_copies, web_domain.backup_excludes as WebDomain_backup_excludes, web_domain.active as WebDomain_active, web_domain.traffic_quota_lock as WebDomain_traffic_quota_lock, web_domain.fastcgi_php_version as WebDomain_fastcgi_php_version, web_domain.proxy_directives as WebDomain_proxy_directives, web_domain.last_quota_notification as WebDomain_last_quota_notification, web_domain.rewrite_rules as WebDomain_rewrite_rules, web_domain.added_date as WebDomain_added_date, web_domain.added_by as WebDomain_added_by "
	" FROM web_domain" 
	<< (where.size()?" WHERE "+where:"");
	WebDomainList webdomainList;
	for(row& r: rs)
	{
		WebDomainPtr webdomain(new WebDomain);
		type_conversion<WebDomain>::from_base(r, i_ok, *webdomain);
		webdomainList.push_back(webdomain);
	}
	return webdomainList;
}

int WebDomainRepository::insert(const WebDomain& webdomain)
{
	dataBase << "insert into web_domain(domain_id, sys_userid, sys_groupid, sys_perm_user, sys_perm_group, sys_perm_other, server_id, ip_address, ipv6_address, domain, type, parent_domain_id, vhost_type, document_root, web_folder, system_user, system_group, hd_quota, traffic_quota, cgi, ssi, suexec, errordocs, is_subdomainwww, subdomain, php, ruby, python, perl, redirect_type, redirect_path, seo_redirect, ssl, ssl_state, ssl_locality, ssl_organisation, ssl_organisation_unit, ssl_country, ssl_domain, ssl_request, ssl_cert, ssl_bundle, ssl_key, ssl_action, stats_password, stats_type, allow_override, apache_directives, nginx_directives, php_fpm_use_socket, pm, pm_max_children, pm_start_servers, pm_min_spare_servers, pm_max_spare_servers, pm_process_idle_timeout, pm_max_requests, php_open_basedir, custom_php_ini, backup_interval, backup_copies, backup_excludes, active, traffic_quota_lock, fastcgi_php_version, proxy_directives, last_quota_notification, rewrite_rules, added_date, added_by)\
values(:WebDomain_domain_id, :WebDomain_sys_userid, :WebDomain_sys_groupid, :WebDomain_sys_perm_user, :WebDomain_sys_perm_group, :WebDomain_sys_perm_other, :WebDomain_server_id, :WebDomain_ip_address, :WebDomain_ipv6_address, :WebDomain_domain, :WebDomain_type, :WebDomain_parent_domain_id, :WebDomain_vhost_type, :WebDomain_document_root, :WebDomain_web_folder, :WebDomain_system_user, :WebDomain_system_group, :WebDomain_hd_quota, :WebDomain_traffic_quota, :WebDomain_cgi, :WebDomain_ssi, :WebDomain_suexec, :WebDomain_errordocs, :WebDomain_is_subdomainwww, :WebDomain_subdomain, :WebDomain_php, :WebDomain_ruby, :WebDomain_python, :WebDomain_perl, :WebDomain_redirect_type, :WebDomain_redirect_path, :WebDomain_seo_redirect, :WebDomain_ssl, :WebDomain_ssl_state, :WebDomain_ssl_locality, :WebDomain_ssl_organisation, :WebDomain_ssl_organisation_unit, :WebDomain_ssl_country, :WebDomain_ssl_domain, :WebDomain_ssl_request, :WebDomain_ssl_cert, :WebDomain_ssl_bundle, :WebDomain_ssl_key, :WebDomain_ssl_action, :WebDomain_stats_password, :WebDomain_stats_type, :WebDomain_allow_override, :WebDomain_apache_directives, :WebDomain_nginx_directives, :WebDomain_php_fpm_use_socket, :WebDomain_pm, :WebDomain_pm_max_children, :WebDomain_pm_start_servers, :WebDomain_pm_min_spare_servers, :WebDomain_pm_max_spare_servers, :WebDomain_pm_process_idle_timeout, :WebDomain_pm_max_requests, :WebDomain_php_open_basedir, :WebDomain_custom_php_ini, :WebDomain_backup_interval, :WebDomain_backup_copies, :WebDomain_backup_excludes, :WebDomain_active, :WebDomain_traffic_quota_lock, :WebDomain_fastcgi_php_version, :WebDomain_proxy_directives, :WebDomain_last_quota_notification, :WebDomain_rewrite_rules, :WebDomain_added_date, :WebDomain_added_by)", use(webdomain);
	int id=0;
	dataBase << "SELECT LAST_INSERT_ID()", soci::into(id);
	return id;
}

void WebDomainRepository::remove(const WebDomain& webdomain)
{
	dataBase << "DELETE from web_domain WHERE domain_id=:WebDomain_domain_id AND server_id=:WebDomain_server_id", use(webdomain);
}

void WebDomainRepository::update(const WebDomain& webdomain)
{
	dataBase << "update web_domain set domain_id=:WebDomain_domain_id, sys_userid=:WebDomain_sys_userid, sys_groupid=:WebDomain_sys_groupid, sys_perm_user=:WebDomain_sys_perm_user, sys_perm_group=:WebDomain_sys_perm_group, sys_perm_other=:WebDomain_sys_perm_other, server_id=:WebDomain_server_id, ip_address=:WebDomain_ip_address, ipv6_address=:WebDomain_ipv6_address, domain=:WebDomain_domain, type=:WebDomain_type, parent_domain_id=:WebDomain_parent_domain_id, vhost_type=:WebDomain_vhost_type, document_root=:WebDomain_document_root, web_folder=:WebDomain_web_folder, system_user=:WebDomain_system_user, system_group=:WebDomain_system_group, hd_quota=:WebDomain_hd_quota, traffic_quota=:WebDomain_traffic_quota, cgi=:WebDomain_cgi, ssi=:WebDomain_ssi, suexec=:WebDomain_suexec, errordocs=:WebDomain_errordocs, is_subdomainwww=:WebDomain_is_subdomainwww, subdomain=:WebDomain_subdomain, php=:WebDomain_php, ruby=:WebDomain_ruby, python=:WebDomain_python, perl=:WebDomain_perl, redirect_type=:WebDomain_redirect_type, redirect_path=:WebDomain_redirect_path, seo_redirect=:WebDomain_seo_redirect, ssl=:WebDomain_ssl, ssl_state=:WebDomain_ssl_state, ssl_locality=:WebDomain_ssl_locality, ssl_organisation=:WebDomain_ssl_organisation, ssl_organisation_unit=:WebDomain_ssl_organisation_unit, ssl_country=:WebDomain_ssl_country, ssl_domain=:WebDomain_ssl_domain, ssl_request=:WebDomain_ssl_request, ssl_cert=:WebDomain_ssl_cert, ssl_bundle=:WebDomain_ssl_bundle, ssl_key=:WebDomain_ssl_key, ssl_action=:WebDomain_ssl_action, stats_password=:WebDomain_stats_password, stats_type=:WebDomain_stats_type, allow_override=:WebDomain_allow_override, apache_directives=:WebDomain_apache_directives, nginx_directives=:WebDomain_nginx_directives, php_fpm_use_socket=:WebDomain_php_fpm_use_socket, pm=:WebDomain_pm, pm_max_children=:WebDomain_pm_max_children, pm_start_servers=:WebDomain_pm_start_servers, pm_min_spare_servers=:WebDomain_pm_min_spare_servers, pm_max_spare_servers=:WebDomain_pm_max_spare_servers, pm_process_idle_timeout=:WebDomain_pm_process_idle_timeout, pm_max_requests=:WebDomain_pm_max_requests, php_open_basedir=:WebDomain_php_open_basedir, custom_php_ini=:WebDomain_custom_php_ini, backup_interval=:WebDomain_backup_interval, backup_copies=:WebDomain_backup_copies, backup_excludes=:WebDomain_backup_excludes, active=:WebDomain_active, traffic_quota_lock=:WebDomain_traffic_quota_lock, fastcgi_php_version=:WebDomain_fastcgi_php_version, proxy_directives=:WebDomain_proxy_directives, last_quota_notification=:WebDomain_last_quota_notification, rewrite_rules=:WebDomain_rewrite_rules, added_date=:WebDomain_added_date, added_by=:WebDomain_added_by WHERE domain_id=:WebDomain_domain_id AND server_id=:WebDomain_server_id", use(webdomain);
}

void WebDomainRepository::update(const WebDomain& oldObj, const WebDomain& newObj)
{
	dataBase << "update web_domain set domain_id=:WebDomain_domain_id, sys_userid=:WebDomain_sys_userid, sys_groupid=:WebDomain_sys_groupid, sys_perm_user=:WebDomain_sys_perm_user, sys_perm_group=:WebDomain_sys_perm_group, sys_perm_other=:WebDomain_sys_perm_other, server_id=:WebDomain_server_id, ip_address=:WebDomain_ip_address, ipv6_address=:WebDomain_ipv6_address, domain=:WebDomain_domain, type=:WebDomain_type, parent_domain_id=:WebDomain_parent_domain_id, vhost_type=:WebDomain_vhost_type, document_root=:WebDomain_document_root, web_folder=:WebDomain_web_folder, system_user=:WebDomain_system_user, system_group=:WebDomain_system_group, hd_quota=:WebDomain_hd_quota, traffic_quota=:WebDomain_traffic_quota, cgi=:WebDomain_cgi, ssi=:WebDomain_ssi, suexec=:WebDomain_suexec, errordocs=:WebDomain_errordocs, is_subdomainwww=:WebDomain_is_subdomainwww, subdomain=:WebDomain_subdomain, php=:WebDomain_php, ruby=:WebDomain_ruby, python=:WebDomain_python, perl=:WebDomain_perl, redirect_type=:WebDomain_redirect_type, redirect_path=:WebDomain_redirect_path, seo_redirect=:WebDomain_seo_redirect, ssl=:WebDomain_ssl, ssl_state=:WebDomain_ssl_state, ssl_locality=:WebDomain_ssl_locality, ssl_organisation=:WebDomain_ssl_organisation, ssl_organisation_unit=:WebDomain_ssl_organisation_unit, ssl_country=:WebDomain_ssl_country, ssl_domain=:WebDomain_ssl_domain, ssl_request=:WebDomain_ssl_request, ssl_cert=:WebDomain_ssl_cert, ssl_bundle=:WebDomain_ssl_bundle, ssl_key=:WebDomain_ssl_key, ssl_action=:WebDomain_ssl_action, stats_password=:WebDomain_stats_password, stats_type=:WebDomain_stats_type, allow_override=:WebDomain_allow_override, apache_directives=:WebDomain_apache_directives, nginx_directives=:WebDomain_nginx_directives, php_fpm_use_socket=:WebDomain_php_fpm_use_socket, pm=:WebDomain_pm, pm_max_children=:WebDomain_pm_max_children, pm_start_servers=:WebDomain_pm_start_servers, pm_min_spare_servers=:WebDomain_pm_min_spare_servers, pm_max_spare_servers=:WebDomain_pm_max_spare_servers, pm_process_idle_timeout=:WebDomain_pm_process_idle_timeout, pm_max_requests=:WebDomain_pm_max_requests, php_open_basedir=:WebDomain_php_open_basedir, custom_php_ini=:WebDomain_custom_php_ini, backup_interval=:WebDomain_backup_interval, backup_copies=:WebDomain_backup_copies, backup_excludes=:WebDomain_backup_excludes, active=:WebDomain_active, traffic_quota_lock=:WebDomain_traffic_quota_lock, fastcgi_php_version=:WebDomain_fastcgi_php_version, proxy_directives=:WebDomain_proxy_directives, last_quota_notification=:WebDomain_last_quota_notification, rewrite_rules=:WebDomain_rewrite_rules, added_date=:WebDomain_added_date, added_by=:WebDomain_added_by WHERE domain_id='"<<oldObj.getDomainId()<<"\'' AND server_id='"<<oldObj.getServerId()<<"\'", use(newObj);
}

